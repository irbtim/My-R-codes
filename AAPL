getSymbols(src="yahoo","AAPL", from="2010-01-01", to="2015-01-01")
AAPL<-data.frame(AAPL)
AAPL$Date<-rownames(AAPL)
colnames(AAPL)<-c("Open","High","Low","Close","Volume","Adjusted","Date")
AAPL$Date<-as.Date(AAPL$Date)
AAPL$Returns<-c(NA,diff(log(AAPL$Adjusted)))
str(AAPL)
strategy<-xts(AAPL$Returns,order.by = AAPL$Date)
charts.PerformanceSummary(strategy)
table.AnnualizedReturns(strategy)
AAPL$ReturnsSign<-ifelse(AAPL$Returns<0,"Down","Up")
AAPL$ReturnsTom<-c(AAPL$ReturnsSign[-1],NA)
AAPL$Weekday<-factor(weekdays(AAPL$Date))
AAPL$IntraDay<-factor(ifelse(AAPL$Close-AAPL$Open>0,1,-1))
AAPL<-AAPL[-c(1,nrow(AAPL)),]
head(AAPL)
train<-AAPL[1:600,]
test<-AAPL[-(1:600),]
simple.tree<-rpart(data=train, ReturnsTom ~ ReturnsSign + Weekday + IntraDay, method = "class")
fancyRpartPlot(simple.tree, sub = "Simple tree from rforfinance.ru")
Prediction<-as.character(predict(simple.tree,test,type="class"))
strategies<-data.frame(rep("Up",nrow(test)),Prediction)
strategies<-rbind(c(NA,NA),strategies[-nrow(strategies),])
colnames(strategies)<-c("Buy&Hold","Simple tree strategy")
head(strategies)
strategies<-ifelse(strategies=="Up",test$Returns,-test$Returns)
charts.PerformanceSummary(xts(strategies,order.by = test$Date))
table.AnnualizedReturns(xts(strategies,order.by = test$Date))
maxDrawdown(xts(strategies,order.by = test$Date))
